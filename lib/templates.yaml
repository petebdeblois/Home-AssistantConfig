#########################################################################
#########################################################################
#########################################################################
##################             Binary              ######################
#########################################################################
#########################################################################
#########################################################################

- binary_sensor:
  - name: Home Occupied
    state: >
      {{ is_state('device_tracker.pete_s20', 'home')
        or is_state('device_tracker.julie_s20', 'home') }}
- binary_sensor:
  - name: "Washing Machine"
    delay_off:
      minutes: 5
    state: >
      {{ states('sensor.washing_machine_power')|float > 0 }}
  # https://smarthomepursuits.com/display-offline-unavailable-or-missing-sensors-in-home-assistant/

# Is Today a School Day?
# https://community.home-assistant.io/t/morning-automation-based-on-calendar/334274
  - name: School Day
    state: "{{ is_state('calendar.school', 'on') }}"
#########################################################################
#########################################################################
#########################################################################
##################            SENSORS              ######################
#########################################################################
#########################################################################
#########################################################################

- sensor:
  - name: Unavailable Entities
    unit_of_measurement: entities
    icon: "{{ 'mdi:check-circle' if is_state('sensor.unavailable_entities','0') else 'mdi:alert-circle' }}"
    state: >
      {{ states|selectattr('state','in',['unavailable','unknown','none'])|rejectattr('domain','eq','group')
          |rejectattr('entity_id','in',state_attr('group.ignored_entities','entity_id'))|list|count }}
    attributes:
      entities: >
        {{ states|selectattr('state','in',['unavailable','unknown','none'])|rejectattr('domain','eq','group')
            |rejectattr('entity_id','in',state_attr('group.ignored_entities','entity_id'))|map(attribute='entity_id')|list }}

  #----- Count Automations
  - name: Count Automations
    state: "{{ states.automation | list | length }}"
  #----- Count Scripts
  - name: Count Scripts
    state: "{{ states.script| list | length }}"
  #----- Count Device Trackers
  - name: Count Device Trackers
    state: "{{ states.device_tracker | list | length }}"
  #----- Count Binary Sensors
  - name: Count Binary Sensors
    state: "{{ states.binary_sensor| list | length }}"
  #----- Count Sensors
  - name: Count Sensors
    state: "{{ states.sensor | list | length }}"
  #----- Count Switches
  - name: Count Switches
    state: "{{ states.switch | list | length }}"
  #----- Count Zones
  - name: Count Zones
    state: "{{ states.zone | list | length }}"
  #----- Input Booleans
  - name: Count Input Booleans
    state: "{{ states.input_boolean | list | length }}"
  #----- Input Numbers
  - name: Count Input Numbers
    state: "{{ states.input_number | list | length }}"
  #----- Input Texts
  - name: Count Input Texts
    state: "{{ states.input_text | list | length }}"
  #----- Input Selects
  - name: Count Input Selects
    state: "{{ states.input_select | list | length }}"
  #----- Input Date Times
  - name: Count Input Datetimes
    state: "{{ states.input_datetime | list | length }}"
